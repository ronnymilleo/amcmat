function [y1] = amcFcn(x1)
%AMCFCN neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-Sep-2019 15:11:01.
% 
% [y1] = amcFcn(x1) takes these arguments:
%   x = 9xQ matrix, input #1
% and returns:
%   y = 6xQ matrix, output #1
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0.282353684522168;1.56707198947251;0.124721065580425;0.139036531346957;2.24195202084354;0.109600243279282;0.0150099019455998;0.0735862560282201;0.122518644022981];
x1_step1.gain = [1.55179952037816;3.66733044720092;7.62404820364433;5.93149508496629;0.655737813439947;0.0155107529456746;3.18426143571599;4.70816297008179;2.94285662786271];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.7487474296749239144;-2.694416819131718821;-1.9770652549173415302;-0.6979132232499031252;-4.4368468327711347854;-3.8446666418473083304;-2.3278701115726141424;-9.7358684999951528027;-1.4107496782228516885;1.8066809792509497257];
IW1_1 = [1.6387794830850375138 -0.67087099378423342699 0.68600202508773078236 -1.338397316287802008 -0.51559856590072028482 0.18979825742616027173 5.0444424715432498729 0.0090894052270415800349 -10.291053803025556945;-0.23592450193808239822 0.13358083386448427188 -0.26466346600914597564 -0.48860119014774033852 0.059055404509701932281 0.046050351461480253101 -5.4192914113526287068 -0.58664056628636152002 10.640416729641831495;-3.0790958737187352767 0.29610006156931628629 -3.884090047818574476 3.15308337694421148 0.21702000467906806813 0.19828103917268133372 0.77344499722979809242 0.058446089253343005976 -0.67047926100739818622;4.4366711092074995193 -0.84847722777752976331 -0.26641958170097351788 0.30797661548292670775 -0.22569132541339478881 0.88049935078708496672 -4.9647748240906803829 -0.58194192448525783323 2.7040910804667470657;-0.20060514664995698908 0.083583349879424589934 -0.080937963897703926741 -0.011915426020370385729 0.049937138107052338187 -0.012750218200880516009 -13.495661611595552998 -0.11250520750635152611 7.6392291734602757458;3.3421926793497571673 -0.81290941829190432877 -0.35834099329205049145 -0.86923012590015258372 -0.32018370138835811067 0.83031524075694451703 -14.542578095767165536 -0.8193984780638293719 14.110236873718035255;1.6184249690354777229 1.1691275318082858803 1.1083816783004334372 -0.58506009908169309686 1.0656862600667507124 -0.81071727380709557309 -5.6205201153654122948 -2.7992633770478341226 10.986516452094825524;-3.0219817940242696963 0.24735336622583881105 0.97148098286008799374 -0.098233067945512439478 -0.15588361563905575591 -0.62290417917721618846 -23.22762014181397916 1.6531087466833014332 27.501372927626480447;-0.51231816816045272489 0.32080351906297055464 1.5300237456179404116 1.7886267923317431539 0.37741997502884711002 -0.34937097532379263187 -0.39465445600588350272 2.2141710608203117872 -1.5181549827895846061;-0.45983711623560036275 0.70817663684992471218 -2.555306565048151235 5.9436140888548765204 4.2660058195019141536 -1.8582927836498919216 0.45201357157564303613 2.9866734832600392302 0.12203063188088417168];

% Layer 2
b2 = [11.34097922003357084;-0.21112998981072886306;4.5431080760831799026;-0.2318906537918745403;0.08011291043848765836;-0.71973849925714994402;3.9560136323923575929;-2.4657893377868687068;3.5602226283367630622;5.4495177466423827539];
LW2_1 = [-3.6882823629065240034 7.0914997906683625573 1.194761284754049413 6.930059045335456247 10.917599016823782421 15.780256292950532782 6.7431098426795843537 25.117968710454086079 0.059390240023399584746 -2.3692814679674865097;-5.3052466774246429537 1.2385277091708686292 -3.1869331916534076043 8.529969543457697867 1.7936737917382061802 -2.1544153257931482059 3.3849826360250552248 1.2284533553298035979 0.40971102579026691393 0.32604279500227822952;-7.7223812043764992197 -4.1104328608889373342 -2.4967134613092971662 -2.9083028815932725486 2.5008838131884583156 1.5935004711565599056 -0.78099741070384187669 1.9883302129932620694 2.2242212797186935447 0.69333546854162708684;-0.94634487704104286454 3.0733233540820892316 -3.0349967586112889251 10.573330737554975656 -7.4209571454943930036 2.9539401024115603533 -2.9882087535375019272 -9.0813951093972171691 1.4876776011384413856 -0.42159710679104844822;-1.2702485853683276318 3.2482382137165624059 -4.62235807659083342 -2.3217849371936671865 3.3322723558822819889 0.85847577665010488257 1.0754998017199117744 -1.0317463129478741113 0.32114837101910376216 -0.49577819397144834435;-4.8551717103494853589 -5.552579805147822789 -1.9163500019796166907 8.3016433867865728757 -3.7209043165319357627 -4.5182072232756178565 -4.4638472596870348852 0.39934001718521244806 -0.77030221400674936394 -0.24909404686402036866;-1.5940295600995872949 14.888041194895723862 5.9450326893449645382 13.253389204237571164 13.194064702516417498 2.0798272284473631188 3.4690494078120703847 16.417432587760149687 -0.50361503388061756858 7.2938357267728308742;-2.1738663975710155185 -1.762734706376771987 -1.7868515142559542319 -3.7825110844434202129 1.7502494460515840569 -0.055546046601989050584 3.6618501595256511827 -5.2492590592987928844 -2.0184597380230733243 0.50464671173411934646;-6.3009067688938635854 -2.7379751759643045084 1.1830997172186326072 -2.4816154712628275547 2.3908462014731171053 9.3896750398713386687 4.998880704784011364 7.9692807130178771047 -1.5652256707735214825 -2.27683849910569025;-3.8349142999341774285 0.35512228679499685535 -0.34311360428858611593 8.9367305278143298608 5.2657530489685306918 0.93058153517415986844 -2.0580125309849695014 10.746847389075155021 -2.7668470509486189357 -2.4016393198587175917];

% Layer 3
b3 = [7.6141477335080267608;2.5862794582653449993;-4.3137882207194904183;-1.6465547425360125278;-6.1100090053903990395;3.7638827508388370546;5.5186014994283087987;-0.00053396277141090175804;2.3861846314013281933;-6.4962906814549201684];
LW3_2 = [-5.7538676165533653162 2.3521075633619821232 -0.30401995717454827206 -1.5221700829432553981 11.084502164884321829 7.6740363312968620235 -7.8213417983417041768 -0.14015100466410945756 -6.1786335629149906623 -6.2337248967751950346;-3.2170735489122259665 1.3501987215520014907 2.6644601208251219582 0.38573375109158652974 2.542774018916237555 0.87318823983046867099 -3.1877033632062330426 0.81674139765006148473 2.8022377870473715866 5.4011434546644574439;-21.41116089532652822 -3.2607815502690540299 3.8838911325052487555 -2.3350514868912433109 -3.2534945429901616087 -3.1617924060033879563 -19.767274170841336201 0.82111793118464226904 -9.8886035080068701575 -10.262308482629702411;-2.6724749136208094669 -0.69208741127930573089 5.9401188831014959391 -1.3820306993671431783 -1.3112973372984704223 1.4360742836295592451 -2.5456046297789285404 3.8216387013532999717 -2.9570546328873312802 -0.080449373089635373146;-13.546144006277360816 0.39836990856653392568 2.1867202065334789829 1.4191083242146271814 -5.1036928898305085056 2.8033070013949803467 -18.060472309018784642 4.9172436451160619342 0.044379941782157213137 0.3270465913731808727;13.803955670135970024 -0.80180071236030925341 -2.8229687167231087841 0.120079720804563847 -3.125313069874810612 -0.16108625264364465068 15.230967387905007371 5.0681111430261074347 5.4511841595668872884 5.1760096301297551236;-5.5197631386090213468 0.92834642357287211478 -0.63967542680297451163 -0.52336697188424974314 1.4772819942913024693 0.43330001638183623935 -8.7910104716948431758 2.1683466007780394236 -1.7472377920157124986 -2.5673816632613566391;11.304846816343172122 1.3862651786930733078 -1.5813847167359971202 3.0783074549908002737 0.86169786068770748422 -5.0665105523204161386 -10.660392796150688355 2.9325131241642306001 5.5396479656631338884 -5.5694486043681221688;2.3526096715182571728 2.5385807608099155708 -5.1259610561495962955 -5.3986712891436354766 1.4454064575703473583 -2.1297606001969637823 -0.53093884461400631114 4.8473421523789781418 -4.0828094309860123445 0.48845308264835474166;-12.905263778267009656 -9.262307445393787475 3.229882679385672084 0.95783056241490105442 1.053539741137296204 2.1732041792450131901 -14.144299529830961504 8.1834652287737625898 -0.68414587525765391263 -1.2154241987698382044];

% Layer 4
b4 = [1.4382556600428189064;2.7803820759169783905;5.3278491937231828857;-7.0673449529664846835;-1.0301593863527864769;1.4139968674875749155];
LW4_3 = [4.1790611038765286267 -4.2568761057695754246 -2.181037938603579196 13.065514108310599894 -4.388942276820216648 -5.9471717178394616354 4.2800183228800614543 5.189129513848709685 -0.074837195233090209046 10.50815544871860574;6.2947703638940746274 8.3206638371395911236 8.6362709335366645291 -11.1802307592203789 7.8502709298572836971 7.3293936062401794373 1.2920793759234583398 4.2252703150452006753 -11.489930278716393275 5.0159950008355709272;-12.658727308240132814 6.0447626603023634217 2.2796130064941397819 -2.254367217544547497 2.9359971477524458017 -5.3686700326901402036 9.1166271770878886116 5.5147579370009838229 6.6957684423542751517 -13.541731219547038734;-7.2808974657462934843 -4.4758173340531612894 -22.857906651582702295 4.2453237610062473095 -14.315205804694224767 13.301384179121292561 -12.667713195331232967 -8.534816386800216037 -0.76368340012907909298 -12.245192907320351594;7.1018168094297315918 -0.68529633605628137438 15.713849601843371317 0.022062137731481853281 9.8200985082710126051 -10.628155590619936532 0.46151268867355299541 -4.0774143572428185323 0.69051725140355035837 15.133847844387721793;3.0572350241598540421 -6.1473775666854262312 -2.7434861059071806721 -4.8039477433551107666 -2.9866944569558087075 2.1957271536957918556 0.31809943106124782819 -2.2367335951846105679 4.8315892473372237248 -3.7446827168731120494];

% ===== SIMULATION ========

% Dimensions
Q = size(x1,2); % samples

% Input 1
xp1 = mapminmax_apply(x1,x1_step1);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);

% Layer 3
a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);

% Layer 4
a4 = softmax_apply(repmat(b4,1,Q) + LW4_3*a3);

% Output 1
y1 = a4;
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
  if isa(n,'gpuArray')
    a = iSoftmaxApplyGPU(n);
  else
    a = iSoftmaxApplyCPU(n);
  end
end
function a = iSoftmaxApplyCPU(n)
  nmax = max(n,[],1);
  n = bsxfun(@minus,n,nmax);
  numerator = exp(n);
  denominator = sum(numerator,1); 
  denominator(denominator == 0) = 1;
  a = bsxfun(@rdivide,numerator,denominator);
end
function a = iSoftmaxApplyGPU(n)
  nmax = max(n,[],1);
  numerator = arrayfun(@iSoftmaxApplyGPUHelper1,n,nmax);
  denominator = sum(numerator,1);
  a = arrayfun(@iSoftmaxApplyGPUHelper2,numerator,denominator);
end
function numerator = iSoftmaxApplyGPUHelper1(n,nmax)
  numerator = exp(n - nmax);
end
function a = iSoftmaxApplyGPUHelper2(numerator,denominator)
  if (denominator == 0)
    a = numerator;
  else
    a = numerator ./ denominator;
  end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end
