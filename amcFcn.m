function [y1] = amcFcn(x1)
%AMCFCN neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-Sep-2019 15:53:19.
% 
% [y1] = amcFcn(x1) takes these arguments:
%   x = 9xQ matrix, input #1
% and returns:
%   y = 6xQ matrix, output #1
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0.282615528272619;1.56575765778097;0.123668289743005;0.137736840453941;2.26708524983489;0.111016167927901;0.0150241355705254;0.0733680973566591;0.122576721390973];
x1_step1.gain = [1.55211485502156;3.58355002295519;7.44678223686109;5.91331811197104;0.633360358914144;0.0154716082768333;3.16070179726488;4.66743102354942;2.93050178412029];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.8574623684513271726;-1.6797305576637171498;0.31343184110285848831;4.1485254766825132577;0.090388102847960713482;4.8102701077977503274;-0.88178859457854752435;-5.1660535196226415877;-5.8811544596551170727;1.6212258761429969578];
IW1_1 = [1.907212403526675093 -0.015244224512727453172 -1.1243388421662596777 -1.1757383903070202091 -0.051678153864575422649 -0.11766651077539372339 -1.4400760750026226908 0.56140911121078995727 11.07685311265041328;2.9587416425897874461 4.1036174637367803797 -5.5608909259085113064 0.44339569614105872608 -1.0723664593831394587 -3.1052210063242187132 5.3332799142332021347 1.2847354734336711157 -8.77732558817152686;-0.42191077346892463806 0.93288329896081256809 3.2284455197083850031 -3.3462288440187095695 -0.25492720610110425339 -0.35950109896619492078 -0.29488971036698552464 -0.21640280762569566453 0.82843780143873835264;0.15171598973443836678 -0.0024505311998828361274 0.17493733925265872453 0.054578699388127545344 0.025453414782428348401 -0.059024174018013596255 14.261759126267945064 -0.062254499322257850213 -8.3183604193804470128;4.1918223590322325478 -0.10866554352139862205 -2.716265478741609396 2.8745090244402149438 -0.080388384336132864827 -0.19988130503524775827 6.1234556350762998633 0.91991952128978060621 -3.8803205250269212634;-4.7512449656002155862 -1.3603961334836589536 2.0104015871604867804 -1.963105411338414763 0.47437852357595478026 2.1088216418814407227 5.0456558082968436807 -1.2994604709043116042 -1.278467498138655456;-1.3380956212643158043 -1.2298646980199898771 1.1921135153521107419 -1.2458538808530099651 0.34080346258912030954 0.059894480617282523649 -4.9100979782416880326 0.14142102234899028845 6.4516108817930089003;-4.0019644431926550965 -0.77279870620778845502 -6.0986466668763785748 3.5863322175887430987 0.41724050126072681488 -2.0741899987998766441 -2.1870097787334144002 1.3469117633248386401 1.7667798657205870949;-1.5354018910737818882 0.11530726016735415307 0.85069131231063743748 0.74586387028922218612 0.061696005928752850611 -0.32626685265505461775 -10.846517765103978803 -0.47327609241325940825 19.073334109627055;5.4873262134400428991 4.9402050525617866583 -8.4584190276437904998 -2.5929792870715555608 -1.4129434956955413405 2.7631380711632989033 -2.9699594730815226384 -0.053848022038655109223 4.7019034129821557499];

% Layer 2
b2 = [6.5964385258294715442;0.9063565529157850964;-2.5468934313003606107;-0.4732548009549154;2.9369934805715796067;-1.8990838006866779253;-2.2556880635736251683;2.666291597592242546;-0.67288331296863190811;2.9749251136852383759];
LW2_1 = [1.0355546923844336504 -1.3443040455648385123 6.5117830690486435685 -11.792431227838982011 -0.83150608362429956344 -4.4431877073358059249 7.2644198259873897783 1.1866466382155063108 12.620150899839833514 0.34373982738557418148;-5.4927677906080232262 -0.24974568569074870328 1.6935649167259179126 14.466942488423628177 -2.9617319078105435182 -1.8500870514913927423 1.4898817661858545502 -0.12964381309626682448 -7.0607598673035569803 0.0089850720057736855467;1.0484163693111052673 -0.01292573028869892747 1.5790781677507170766 -0.29203945402417541555 -0.15389441161098213473 -0.52768372505545801943 -0.79771161420977876322 -0.57497685697207723265 1.2554326155583306335 0.017808752250698754033;-3.5773028642595243731 0.37426103173009445113 -0.1795058283173221747 3.3173881592138192431 2.8469823779744403147 2.0924285326604601387 -0.45335432486600441004 2.4194822723541329346 0.44734774441483710072 0.87076568145613442162;-3.2708507178006676064 -3.1365309848185933816 -1.7386539420268471989 -0.58087785350375131799 0.39539635618872587264 -2.3276195791088447606 -0.10769224260906570811 -7.8520569312075432222 5.5254885350988303117 4.0338353666729522828;-5.5972188291713687036 7.0028262382458903446 2.5086487055733686091 7.9651813390545562754 2.5199506149377270958 9.656540127056608469 1.9234954623311490973 -0.12354919130741863487 -5.1052545807255294008 -2.2382700971665467904;3.0989634900756635183 0.15371268609585611586 4.7065305632160425731 5.9878492523269803982 -3.1565720413311861847 1.6771824891361184484 3.1047801423662604314 -4.0936615451410709454 2.3757070679000054092 -0.71797912322588974821;3.0387475485642938544 -0.8770531815352584637 2.2611554595780298804 1.539768791263890213 7.5279623460301641202 -0.39484536050600055335 -3.9992666415312170258 -5.7277480791587889186 -8.4095870550357965101 -2.6225320386339832091;2.715148389550194441 -0.26064925221639229092 0.52195332672697103416 2.2254720006865742477 -2.3704425626031842 -2.1835106634737684317 4.3747005123569753238 2.3939815243689732682 -3.9444810075692182672 -0.67985104177219912724;0.94703285958869676264 -0.60896991481264173274 2.0572983418137105183 -10.510865593525839046 -1.0926119338206603526 -2.5939581722886151383 10.603447105101633241 -1.1058960795751022754 10.565614675372613007 2.5142257995376180446];

% Layer 3
b3 = [1.3358714096056718557;0.40798884597384987849;1.449347060145052879;-0.1755226458161948111;-0.77551768549461441715;-1.6649781462138850685;-1.0966208725041495242;0.27992765461236701618;-1.1967141404090018142;0.030176202661383474957];
LW3_2 = [12.380882596736837442 -9.2112881900333842822 -3.9169499050655289807 -2.5915695037054096161 1.6223380010621522018 -10.841388784830639835 1.1853269554169267863 -3.7758118471371364677 -0.3354844328893303862 8.7594609382551240628;7.3063781616443304046 4.0513286901401377449 -1.5971433352051058741 -0.48877468768774329222 -1.6280752527079025427 4.7449852450736429432 -1.5800951480617486666 0.8849889412868363614 0.59169918185074732442 1.018644390836238367;-3.2591038740729616485 -4.5191249596404512445 -0.73264828651154578765 1.9884159647064618692 -5.2344656683824437593 -0.95378576103729029168 -0.71712208305293378974 2.4682252172805156931 -0.56045823377150438827 -4.9975482050299202541;-2.1614062709106987015 4.2756364000138624704 0.7142049498074509728 0.9321009199611387519 2.1487675001547303921 -4.2023269625985619768 0.5350097338782848766 3.2764866295072576641 1.9996632351870231581 -5.549490978786380424;-0.50966332864852725848 -0.79355435183703870727 0.18316233901806056039 0.25794454122794868711 1.440286109001398307 3.3316290301155153664 -3.4949408177685281629 -1.2871725484790887961 2.0554816299460139106 -2.3938091508043957134;-5.8849160917465539455 3.7903987217451491354 1.5079147680303179868 0.23037081268217904362 -0.69779745550027083567 3.7575593883904967463 -2.4370068740700689958 0.91030126171739922381 -0.46717166383214575598 1.8967150823785872138;-3.7562160535617166168 0.50201147809347246298 0.3844051900144258016 -2.8626187685903228264 0.25179550236257902673 4.7826214125830590618 -4.188005423979602071 0.92444134746935913149 0.43856747667442080862 -5.2826468956187042636;-10.479585058021561039 16.008614919577951241 -1.6267028604899194111 2.2468143704843299702 0.11593260700745780523 8.980318184276420368 3.202413837493089499 1.1338183064646971676 2.5257421587259982765 -11.474678929323003373;-3.8634539194601074108 2.1738800655993553157 0.22046588350853943417 1.2673980424599236017 -1.6204230584908667634 1.9436419272504792399 1.089440295517493773 2.2945273163168522501 -0.94415780706613439133 0.20156845046817525868;-4.244330217194998589 -5.8731745761043860909 -1.1359755961765294341 0.24910225307296704478 -0.49554112701628288962 12.824562950628820346 1.2065534035131517676 7.449844263620422069 -1.4611962163184071262 -3.7123629018238113453];

% Layer 4
b4 = [-0.14670475394516552248;1.6573381999424652289;3.271139645671124363;-3.1131570251554552264;-2.2712287426625907827;-0.30556644009681038776];
LW4_3 = [11.874030715195573293 -1.6955257195157351635 -5.1368088810901761931 -1.9460629977053700568 4.0159637174209912303 -1.2840302244740284809 1.6887551532190119286 -4.2215664058048112395 4.3638369656468292135 3.0963970463823824453;1.6881932440959266373 -1.0961958226679269224 -3.6383718842135084337 -0.69223865806905704456 -0.18071608216739848407 0.93163826459453336071 -2.0639499124042730571 0.72236109580698160126 -0.93272578526083060879 5.5480408247005339462;-0.62485765133365256396 6.928458228756702475 4.6900172215255571118 -0.64069094291253259055 -0.16468027925260556033 -2.5309674042087606516 -6.2799349561820632104 -6.6910023978443406989 -6.6237688189328833843 -11.869408588821737993;5.9935721392580481037 -1.6645186814690371424 2.9864898814296187979 -1.3891883414407513175 1.2786753983897929388 -2.7510145544919928362 4.1337386307639274463 -10.651229139314363437 0.54681743366250612493 3.3973277083933326459;-17.986589068147896597 0.21698071874566027262 0.29734636715180878808 3.321213894979413439 -0.43394908551555677612 5.6172141033865683468 5.4069061445904038621 18.822413607207984398 0.22661880918240920324 0.69699489197333852619;-0.35781886584178440591 -1.9685071239303864044 -1.5721349757354576848 1.1849104102166343466 -3.6628226430139116943 -0.76217940443139731155 -1.8706734465833696479 0.97982177440423867676 2.6036232482033248026 -0.54489093484176776006];

% ===== SIMULATION ========

% Dimensions
Q = size(x1,2); % samples

% Input 1
xp1 = mapminmax_apply(x1,x1_step1);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);

% Layer 3
a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);

% Layer 4
a4 = softmax_apply(repmat(b4,1,Q) + LW4_3*a3);

% Output 1
y1 = a4;
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
  if isa(n,'gpuArray')
    a = iSoftmaxApplyGPU(n);
  else
    a = iSoftmaxApplyCPU(n);
  end
end
function a = iSoftmaxApplyCPU(n)
  nmax = max(n,[],1);
  n = bsxfun(@minus,n,nmax);
  numerator = exp(n);
  denominator = sum(numerator,1); 
  denominator(denominator == 0) = 1;
  a = bsxfun(@rdivide,numerator,denominator);
end
function a = iSoftmaxApplyGPU(n)
  nmax = max(n,[],1);
  numerator = arrayfun(@iSoftmaxApplyGPUHelper1,n,nmax);
  denominator = sum(numerator,1);
  a = arrayfun(@iSoftmaxApplyGPUHelper2,numerator,denominator);
end
function numerator = iSoftmaxApplyGPUHelper1(n,nmax)
  numerator = exp(n - nmax);
end
function a = iSoftmaxApplyGPUHelper2(numerator,denominator)
  if (denominator == 0)
    a = numerator;
  else
    a = numerator ./ denominator;
  end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end
